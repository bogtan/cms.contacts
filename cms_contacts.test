<?php

module_load_include('test', 'cms', 'cms');
module_load_include('inc', 'cms_contacts', 'cms_contacts.cache');

class CMSContactsWebTestCase extends CMSWebTestCase {

    public static function getInfo() {
        return array(
            'name' => 'CMS Contacts Test',
            'description' => 'Verify functionality of CMS Contacts module.',
            'group' => 'CMS Tests'
        );
    }

    function setUp() {
        parent::setUp('cms', 'cms_contacts');
        $user = $this->drupalCreateUser(array('administer site configuration'));
        $this->drupalLogin($user);
        self::$bundle = 'contacts';
    }

    function test_security_role_anonymous() {
        $this->drupalLogout();
        $this->ensure_access_denied('/manage/contacts/listing', 'anonymous');
    }

    function test_security_role_authenticated() {
        $user = $this->drupalCreateUser();
        $this->drupalLogin($user);
        $this->assertNotNull($this->loggedInUser);
        $this->ensure_access_denied('/' . ADMINISTRATION_PATH . 'contacts/listing', 'authenticated');
    }
}

class CMSContactsCacheTestCase extends CMSWebTestCase {

    public static function getInfo() {
        return array(
            'name' => 'CMS contacts cache tests',
            'description' => 'Verify the caching functionality',
            'group' => 'CMS Tests'
        );
    }

    public function setUp() {
        parent::setUp();

        variable_set(LDAP_BASE_DN, 'o=CMS');
        variable_set(LDAP_BIND_RDN, 'uid=sysadmin,o=CMS');
        variable_set(LDAP_PEOPLE_DN, 'ou=Users,o=CMS');
        variable_set(LDAP_ORGANIZATION_DN, 'ou=Organizations,o=CMS');
        variable_set(LDAP_DEPARTMENT_DN, 'ou=Departments,o=CMS');
        variable_set(LDAP_PASSWORD, 'XXXX');

        variable_set(LDAP_ADDRESS, 'XXXX');
        variable_set(LDAP_PORT, 'XXX');
    }

    function test_cache_ldap_users() {
        CMSContactsCache::cache_ldap_users();
    }
}